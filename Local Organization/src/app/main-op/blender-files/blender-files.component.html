<form
    [formGroup]="fg"
    class="grid mb-3"
>
    <div class="flex align-items-center justify-flex-start gap-3 col-12">
        <p>Select a drive to scan</p>

        <p-dropdown
            formControlName="drive"
            [options]="drives"
            placeholder="Select Drive"
        />
    </div>

    <div class="col-12">
        <p-button
            type="button"
            size="small"
            [outlined]="true"
            severity="secondary"
            [disabled]="this.fg.controls.drive.invalid"
            (onClick)="findBlenderFiles()"
        >
            Find Blender Files
        </p-button>

        @if (blenderFinder.isChecking) {
            <p-button
                type="button"
                size="small"
                [outlined]="true"
                severity="secondary"
                (onClick)="stop()"
            >
                Stop
            </p-button>
        }

        <!-- <button
            class="mx-4"
            type="button"
            pButton
            size="small"
            [outlined]="true"
            severity="secondary"
            (click)="selectDirectory()"
        >
            Select Directory
        </button> -->
    </div>
</form>

<div class="p-0 mt-3">
    <p-table
        #dt
        styleClass="p-datatable-sm"
        [value]="files"
        [columns]="cols"
        [paginator]="true"
        [showJumpToPageDropdown]="true"
        [showPageLinks]="true"
        [rows]="50"
        [resizableColumns]="true"
        [globalFilterFields]="['name', 'filename', 'lastModified', 'birth']"
        [sortField]="'lastModified'"
        [sortOrder]="-1"
        dataKey="id"
    >
        <ng-template pTemplate="caption">
            <div class="flex justify-content-between align-items-center">
                <p-iconField iconPosition="left">
                    <p-inputIcon>
                        <i class="pi pi-search"></i>
                    </p-inputIcon>
                    <input
                        pInputText
                        type="text"
                        (input)="
                            dt.filterGlobal($event.target.value, 'contains')
                        "
                    />
                </p-iconField>

                <button
                    class="mx-4"
                    type="button"
                    pButton
                    size="small"
                    [outlined]="true"
                    severity="secondary"
                    (click)="findImages()"
                >
                    Find Images
                </button>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th
                    *ngFor="let col of cols"
                    pResizableColumn
                    [ngStyle]="col.style"
                    [pSortableColumn]="
                        col.sortField ? col.sortField : col.field
                    "
                >
                    <div class="flex justify-content-between">
                        <div class="float-left">
                            {{ col.header }}
                        </div>
                        <p-sortIcon
                            *ngIf="!col.noScroll"
                            class="float-left"
                            [field]="col.sortField ? col.sortField : col.field"
                        ></p-sortIcon>
                    </div>
                </th>
            </tr>
            <tr></tr>
        </ng-template>
        <ng-template
            pTemplate="body"
            let-file
        >
            <tr
                [ngClass]="{
                    'recently-opened': file.recentlyOpened,
                }"
            >
                <td>
                    <div class="flex align-items-center gap-3">
                        <span>{{ file.name }}</span>

                        <p-button
                            icon="pi pi-file"
                            size="small"
                            [outlined]="true"
                            (onClick)="openFile(file)"
                        />
                    </div>
                </td>

                <td>
                    <div class="flex align-items-center gap-3">
                        <span
                            class="dotdot"
                            style="max-width: 512px"
                            [pTooltip]="file.fileLocation"
                            tooltipPosition="top"
                            tooltipStyleClass="max-screen"
                        >
                            {{ file.fileLocation }}
                        </span>

                        <p-button
                            icon="pi pi-folder-open"
                            size="small"
                            [outlined]="true"
                            (onClick)="openFileLocation(file)"
                        />
                        <p-button
                            icon="pi pi-clipboard"
                            size="small"
                            [outlined]="true"
                            (onClick)="copyLocationToClipboard(file)"
                        />
                    </div>
                </td>

                <td>
                    {{ file.lastAccess }}
                </td>
                <td>
                    {{ file.lastModified }}
                </td>

                <td>
                    {{ file.birth }}
                </td>

                <td>
                    <div class="small-pic-container">
                        @if (file.hasPic === true) {
                            @for (image of file.images; track image.id) {
                                <img
                                    [src]="image.thumbnail"
                                    (click)="openPic(file, image.id)"
                                />
                            }
                        }
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
