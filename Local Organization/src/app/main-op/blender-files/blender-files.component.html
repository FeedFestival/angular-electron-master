<form
    [formGroup]="fg"
    class="grid mb-3"
>
    <div class="flex align-items-center justify-flex-start gap-3 col-12">
        <p>Select a drive to scan</p>

        <p-dropdown
            formControlName="drive"
            [options]="drives"
            placeholder="Select Drive"
        />
    </div>

    <div class="col-12">
        <p-button
            type="button"
            size="small"
            [outlined]="true"
            severity="secondary"
            [disabled]="this.fg.controls.drive.invalid"
            (onClick)="findBlenderFiles()"
        >
            Find Blender Files
        </p-button>

        @if (blenderFinder.isChecking) {
            <p-button
                type="button"
                size="small"
                [outlined]="true"
                severity="secondary"
                (onClick)="stop()"
            >
                Stop
            </p-button>
        }

        <button
            class="mx-4"
            type="button"
            pButton
            size="small"
            [outlined]="true"
            severity="secondary"
            (click)="selectDirectory()"
        >
            Select Directory
        </button>
    </div>
</form>

<div class="p-0 mt-3">
    <p-table
        #tableRef
        [value]="files"
        [columns]="cols"
        [paginator]="true"
        [showJumpToPageDropdown]="true"
        [showPageLinks]="true"
        [rows]="50"
        [resizableColumns]="true"
        [globalFilterFields]="['name', 'filename', 'date']"
    >
        <ng-template pTemplate="caption">
            <div class="p-d-flex">
                <button
                    pButton
                    label="Clear"
                    class="p-button-outlined"
                    icon="pi pi-filter-slash"
                    (click)="refresh(tableRef)"
                ></button>
                <span class="p-input-icon-left float-right p-ml-auto">
                    <i class="pi pi-search"></i>
                    <input
                        pInputText
                        type="text"
                        (input)="
                            tableRef.filterGlobal(
                                $event.target.value,
                                'contains'
                            )
                        "
                        placeholder="Search keyword"
                    />
                </span>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th
                    *ngFor="let col of cols"
                    pResizableColumn
                    [ngStyle]="col.style"
                    [pSortableColumn]="
                        col.sortField ? col.sortField : col.field
                    "
                >
                    <div class="float-left">
                        {{ col.header }}
                    </div>
                    <p-sortIcon
                        *ngIf="!col.noScroll"
                        class="float-left"
                        [field]="col.sortField ? col.sortField : col.field"
                    ></p-sortIcon>

                    <p-columnFilter
                        *ngIf="col.filterType === FILTER_TYPE.TEXT"
                        class="float-right"
                        type="text"
                        [field]="col.field"
                        display="menu"
                    ></p-columnFilter>

                    <p-columnFilter
                        *ngIf="col.filterType === FILTER_TYPE.BOOL"
                        class="float-right"
                        type="boolean"
                        [field]="col.field"
                    >
                        Has Pics
                    </p-columnFilter>
                </th>
            </tr>
        </ng-template>
        <ng-template
            pTemplate="body"
            let-file
        >
            <tr
                [ngClass]="{
                    'recently-opened': file.recentlyOpened,
                }"
            >
                <td
                    *ngFor="let col of cols"
                    [ngClass]="col.cClass"
                >
                    <span *ngIf="col.type === 'text'">
                        {{ file[col.field] }}
                    </span>

                    <div *ngIf="col.type === 'name'">
                        <p-button
                            type="button"
                            size="small"
                            [outlined]="true"
                            (click)="openFile(file)"
                        >
                            <span class="pr-3">üéÅ</span>
                            <span>{{ file[col.field] }}</span>
                        </p-button>
                    </div>

                    <div *ngIf="col.type === 'fileLocation'">
                        <div class="float-left">
                            <p-button
                                type="button"
                                size="small"
                                [outlined]="true"
                                (click)="openFileLocation(file)"
                            >
                                <span class="pr-3">üìÅ</span>
                                <span>{{ file[col.field] }}</span>
                            </p-button>
                        </div>
                    </div>

                    <div
                        *ngIf="col.type === 'pictures'"
                        class="small-pic"
                        (click)="openPic(file)"
                    >
                        <img
                            *ngIf="file.hasPic"
                            [src]="file.picUrl"
                        />
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
